<html>
<head>
<link type="text/css" rel="stylesheet" href="mperdikeasgithub.css"/>
<link type="text/css" rel="stylesheet" href="final-code-wavetheory-lightbox.css">
</head>
<body>
<ol reversed>
<li>how to configure the maximum application upload size for Tomcat</li>
This might be necessary, e.g. if you need more than the default configured value of 50.
    <ol>
    <li>Go to the <code>web.xml</code> of the manager application (for instance it could be under <code>/tomcat7/webapps/manager/WEB-INF/web.xml</code>)</li>
    <li>Increase the <tt>&lt;max-file-size&gt;</tt> and <tt>&lt;max-request-size&gt;</tt> found inside the <tt>&lt;multipart-config&gt;</tt> element.
    </ol>
    <br/>No restart is necessary.
<li>install Tomcat7 in my <tt>home</tt> directory (without <tt>sudo</tt> privileges)</li>
I followed the instructions <a href="http://tomcat.apache.org/tomcat-7.0-doc/setup.html">here</a>
(which reference <a href="http://tomcat.apache.org/tomcat-7.0-doc/RUNNING.txt">this file</a>) to 
install Tomcat7 in my my <tt>home</tt> directory.
Steps (as recollected):
<ol>
<li>download binary (not sources) tarball</li>
<pre>
$ mkdir -p ~/downloads && cd ~/downloads
$ wget http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.57/bin/apache-tomcat-7.0.57.tar.gz
</pre>
<li>expand the tarball in my home directory</li>
<pre>
$ cd
$ whoami
voops
$ cp downloads/apache-tomcat-7.0.57.tar.gz .
$ tar xvfz apache-tomcat-7.0.57.tar.gz
</pre>
<li>check whether CATALINA_HOME is properly set and correctly set it in <tt>.bashrc</tt> otherwise<li>
<pre>
$ echo $CATALINA_HOME
/home/voops/apache-tomcat-7.0.57
</pre>
<li>compile and run the <tt>jsvc</tt> tool (?)</li>
At that point I also followed the instructions to compile and run the <tt>jsvc</tt> to run Tomcat
as a daemon, but in the end I failed to use the <tt>jsvc</tt> tool as it apparently requires permissions
I didn't have. Specifically, when running this script I got the following output:
<pre>
---%<---------------------------------------------------------
$ tail -f /home/voops/apache-tomcat-7.0.57/logs/catalina.err 
Cannot open PID file /var/run/jsvc.pid, PID is 12504
Service exit with a return value of 255
Cannot open PID file /var/run/jsvc.pid, PID is 13918
Service exit with a return value of 255
Cannot open PID file /var/run/jsvc.pid, PID is 14260
Service exit with a return value of 255
Switching umask back to 002 from 077
Cannot open PID file /var/run/jsvc.pid, PID is 31946
Service exit with a return value of 255
--------------------------------------------------------->%---
</pre>
... so in the end I am just using scripts <tt>$CATALINA_HOME/bin/startup.sh</tt> and
<tt>shutdown.sh</tt> to start and stop Tomcat (which seem to work just fine regardless)
and is not clear to me what was the purpose of this script.
<li>start the Tomcat</li>
<pre>
$ $CATALINA_HOME/bin/startup.sh
Using CATALINA_BASE:   /home/voops/apache-tomcat-7.0.57
Using CATALINA_HOME:   /home/voops/apache-tomcat-7.0.57
Using CATALINA_TMPDIR: /home/voops/apache-tomcat-7.0.57/temp
Using JRE_HOME:        /usr/local/jdk1.7.0_67
Using CLASSPATH:       /home/voops/apache-tomcat-7.0.57/bin/bootstrap.jar:/home/voops/apache-tomcat-7.0.57/bin/tomcat-juli.jar
Tomcat started.
</pre>
<li>visit the page at 8080 to verify Tomcat is up</li>
This is the page at localhost:8080
<li>configure Tomcat admin users</li>
At that point the manager application cannot be used. To use it you have to edit file <tt>$CATALINA_HOME/conf/tomcat-users.xml</tt>
so that it has the following contents:
<pre>
$ cat /home/voops/apache-tomcat-7.0.57/conf/tomcat-users.xml  | tail -6
  &lt;!-- below 3 lines added by MP@2014.12.02 --&gt;
  &lt;role rolename="manager-gui"/&gt;
  &lt;role rolename="manager"/&gt;
  &lt;role rolename="admin"/&gt;
  &lt;user username="admin" password="admin" roles="admin,manager,manager-gui"/&gt;
&lt;/tomcat-users&gt;
</pre>
<li>final note</li>
I note in passing that the <tt>JAVA_HOME</tt> environment was also correctly set:
<pre>
$ echo $JAVA_HOME
/usr/local/jdk1.7.0_67
</pre>
Whether that was really indispensable or not I did not verify.
</ol>
<li>how to find exact version of Tomcat that's already installed</li>
<pre>
$ whereis tomcat7
tomcat7: /etc/tomcat7 /usr/share/tomcat7
</pre>
<br/>&hellip; then do a:
<pre>
$ find /usr/share/tomcat7 | grep catalina.jar
/usr/share/tomcat7/lib/catalina.jar
</pre>
<br/>&hellip; and given the above, finally a:
<pre>
$ java -cp /usr/share/tomcat7/lib/catalina.jar org.apache.catalina.util.ServerInfo
Server version: Apache Tomcat/7.0.26
Server built:   Apr 1 2013 08:32:04
Server number:  7.0.26.0
OS Name:        Linux
OS Version:     3.2.0-70-generic-pae
Architecture:   i386
JVM Version:    1.7.0_60-b19
JVM Vendor:     Oracle Corporation
</pre>
    <li>Tomcat7 directories</li>
<pre>
    /var/lib/tomcat7
    /usr/share/tomcat7
    /etc/tomcat7
</pre>
    <li>java.lang.OutOfMemoryError: Java heap space in Tomcat7 in Ubuntu</li>
<pre>
    cd /usr/share/tomcat7/bin/
</pre>
    There, make sure the file <b>setenv.sh</b> has the following content (create the file if it doesn't already exist):
<pre>
$ cat setenv.sh 
CATALINA_OPTS="$CATALINA_OPTS -server -Xms256m -Xmx1024m
</pre>
    The reasoning is explained in file <b>catalina.sh</b>.
    <li>how to make Tomcat 7 in Ubuntu 12.04 use the Oracle JDK and not the open JDK</li>
    I effected the following change in the file <b><code>/etc/init.d/tomcat7</code></b>:
    <pre>
    # mperdikeas change section 2013-11-09-start
    #JDK_DIRS="/usr/lib/jvm/default-java ${OPENJDKS} /usr/lib/jvm/java-6-openjdk /usr/lib/jvm/java-6-sun"
    JDK_DIRS="/usr/lib/jvm/java-7-oracle /usr/lib/jvm/default-java ${OPENJDKS} /usr/lib/jvm/java-6-openjdk /usr/lib/jvm/java-6-sun"
    # mperdikeas change section 2013-11-09-end
    </pre>
    <br>You have, of course, to also make sure that the Oracle 7 JDK is installed in Ubuntu by following
    <a href="java.html#install-oracle7-ubuntu-12.04">these instructions</a>.
    <li>how to install and setup Tomcat 7 in Ubuntu 12.04</li>
        <ol>
        <li>install Tomcat</li>
<pre>sudo apt-get install tomcat7</pre>
        <li>verify installation by visiting: <i>localhost:8080</i></li>
        <b>Tomcat</b> can be stopped, started, restarted using: <pre>sudo /etc/init.d/tomcat7 [start|stop|restart]</pre>
        <br/>At this point the various important <b>Tomcat</b> directories (CATALINA_HOME and CATALINA_BASE) are specified
        in the above script (grep for 'CATALINA'). They do not however need to be setup in users' bash environment (see <a href="http://askubuntu.com/q/370080/89663">here</a> for more).
        <br/>The Tomcat logs when deploying to $CATALINA/webapps (typically '/var/lib/tomcat7/webapps/') can be examined with:
        <pre>tail -f /var/log/tomcat7/catalina.out</pre>
        The following may be useful too:<pre>tail -f /var/log/tomcat7/localhost.2013-11-02.log</pre>
        <li>to access the administrative front-end:</li>
        <pre>sudo apt-get install tomcat7-admin</pre>
        ... and then you have to edit file 'tomcat-users.xml':
        <pre>sudo emacs -nw /var/lib/tomcat7/conf/tomcat-users.xml</pre>
        ... and add the following:
        <pre>
        &ltrole rolename="manager-gui"/&gt
        &ltrole rolename="admin"/&gt
        &ltuser username="admin" password="admin" roles="admin,manager-gui"/&gt
        </pre>
        ... the admin front-end is then available at <a href="localhost:8080/manager">localhost:8080/manager</a>
        </ol>
</ol>
</body>
</html>
